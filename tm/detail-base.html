<!-- {% load static %} -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title> Book Recommndation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

    <!-- Bootstrap -->

    <link type="text/css" rel="stylesheet" href="../static/css/bootstrap.min.css" />

    <!-- Slick -->

    <link type="text/css" rel="stylesheet" href="../static/css/slick.css" />
    <link type="text/css" rel="stylesheet" href="../static/css/slick-theme.css" />

    <!-- nouislider -->

    <link type="text/css" rel="stylesheet" href="../static/css/nouislider.min.css" />

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">

    <!-- Custom stlylesheet -->

    <link type="text/css" rel="stylesheet" href="../static/css/style.css" />


    <!-- style-detail -->
    <link type="text/css" rel="stylesheet" href="../static/css/style-detail.css" />

    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

</head>

<body>
    <!-- HEADER -->
    <header>
        <script></script>

        <!-- TOP HEADER -->
        <div id="top-header">
            <div class="container">
                <ul class="header-links pull-left">
                    <li onclick="myFunction()" id="cl"><a href="#"><i class="fa fa-phone"></i>0988888888</a></li>
                    <li><a href="#"><i class="fa fa-envelope-o"></i> dangphong1520@gmail.com</a></li>
                    <li><a href="#"><i class="fa fa-map-marker"></i> 175 Tay Son</a></li>
                </ul>
                <ul class="header-links pull-right" id="menu--bar">
                    <li class="active"><a href="./index-base.html">Home</a></li>

                    <li>
                        <font color="red" ;>Welcome, <span id="get--username"></span>
                        </font>
                    </li>
                    <li><a id="logout" href="#">logout</a></li>

                </ul>
            </div>
        </div>

        <!-- {% block blk %} -->
        <div id="header">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">
                    <!-- LOGO -->
                    <div class="col-md-3">
                        <div class="header-logo" id="img--logo">
                            <a href="index-base.html" id="go--home" class="logo">
                                <img style="border-radius: 50%; margin-top: 15%" src="../static/img/logob.png"
                                    alt="error">

                            </a>

                        </div>
                        <br />
                        <span>
                            <h3 style="color: #FFFFFF">YourReads</h3>
                        </span>
                    </div>


                    <!-- /LOGO -->

                    <!-- SEARCH BAR -->
                    <div class="col-md-6">
                        <div class="header-search">
                            <form>
								<!-- {% csrf_token %} -->
								<div name="stype" class="input-select">
									Book Title
								</div>
								<input type="text" id="search--book" class="input" placeholder="Search here"
									name="searchbox">
								<a name="sbutton" href="#" id="myBtn" class="search-btn">Search</a>
							</form>
                        </div>
                    </div>
                    <!-- /SEARCH BAR -->

                    <!-- ACCOUNT -->
                    <div class="col-md-3 clearfix">
                        <div class="header-ctn">
                            <!-- Wishlist -->
                            <div>
                                <a href="#">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span>Giỏ hàng</span>
                                    <div id="cart--count" class="qty"></div>
                                </a>
                            </div>
                            <!-- /Wishlist -->

                            <!-- Cart -->

                            <!-- /Cart -->
                            <!-- /Menu Toogle -->
                        </div>
                    </div>
                    <!-- /ACCOUNT -->
                </div>
                <!-- row -->
            </div>
            <!-- container -->
        </div>
        <!-- /MAIN HEADER -->
    </header>
    <!-- /HEADER -->

    <!-- NAVIGATION -->
    <nav id="navigation">
        <!-- container -->
        <div class="container" id="product--menu">
            <!-- responsive-nav -->
            <div id="responsive-nav">
                <!-- NAV -->
                <ul class="main-nav nav navbar-nav" id="product--menu">
                    <li class="active"><a id="go--home">Home page</a></li>
                    <li><a href="#">New product</a></li>
                    <li>
                        <a href="#">Category</a>
                        <ul id="product__category--list">
                            <li><a href="#">Category 01</a></li>
                            <li><a href="#">s sd dsf s</a></li>
                            <li><a href="#">s</a></li>
                            <li><a href="#">s</a></li>
                            <li><a href="#">s</a></li>
                        </ul>
                    </li>
                </ul>

                <!-- /NAV -->
            </div>
            <!-- /responsive-nav -->
        </div>
        <!-- /container -->
    </nav>
    <!-- /NAVIGATION -->

    <!-- SECTION -->
    </div>
    <!-- /SECTION -->

    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">

                <!-- section title -->
                <div class="col-md-12">
                    <div class="section-title">
                        <h3 class="title">Chi tiết sách</h3>

                    </div>
                </div>
                <!-- /section title -->

                <!-- Products tab & slick -->
                <div class="col-md-12" id="product--detail">
                    <div class="product__img">
                        <img id="product__image" src="../static/img/book-test.png" alt="" srcset="">
                    </div>
                    <div class="product__content">
                        <div class="product__name">Ten sach: Product 01</div>
                        <div class="product__rating">
                            <div class="rating__start">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>

                            <div class="rating__count">(53,000 đánh giá)</div>
                        </div>
                        <div class="product__price">Giá: 500 Vnd</div>
                        <div class="product__authour">Tác giả: Alex</div>
                        <div class="product__price1">Phiên bản: abc</div>
                        <div class="product__price1">option 02: abc</div>
                        <div class="product__price1">option 03: abc</div>
                        <div class="product__price1">option 04: abc</div>
                        <div class="product__description">Mo ta: to pour… the Font Awesome 6 Beta!
                            The next generation of the web’s favorite icon library + toolkit is now available as a Beta
                            release! Subscribe to Font Awesome Pro and get instant access to the v6 beta.</div>
                        <div class="product__add">
                            <a href="#">Thêm vào giỏ hàng</a>
                            <a href="#">Mua</a>
                        </div>
                    </div>

                </div>
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- SECTION -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">

                <!-- section title -->
                <div class="col-md-12">
                    <div class="section-title">
                        <h3 class="title">Sách gợi ý</h3>

                    </div>
                </div>
                <!-- /section title -->

                <!-- Products tab & slick -->
                <div class="col-md-12">
                    <div class="row">
                        <div class="products-tabs">
                            <!-- tab -->
                            <div id="tab2" class="tab-pane fade in active">
                                <div class="products-slick" id="product--hot-detail" data-nav="#slick-nav-2">

                                    <div class="product product__item">
                                        <div class="product-img">
                                            <img src="../static/img/book-test.png" alt="">
                                        </div>
                                        <div class="product-body">
                                            <div>Name:</div>
                                            <div>Price</div>

                                        </div>
                                        <div class="product__option">
                                            <div class="product__add-cart"><i style="color: white;"
                                                    class="fas fa-cart-plus"></i></div>
                                            <div class="product__rate-ting"><i style="color: yellow;"
                                                    class="fas fa-star"></i></div>
                                            <div class="product__view-count"><i style="color: white;"
                                                    class="fas fa-eye"></i></div>
                                        </div>
                                    </div>
                                    <!-- <div class="product product__item">
                                        <div class="product-img">
                                            <img src="../static/img/book-test.png" alt="">
                                        </div>
                                        <div class="product-body">
                                            <div>Name:</div>
                                            <div>Price</div>

                                        </div>
                                        <div class="product__option">
                                            <div class="product__add-cart"><i style="color: white;"
                                                    class="fas fa-cart-plus"></i></div>
                                            <div class="product__rate-ting"><i style="color: yellow;"
                                                    class="fas fa-star"></i></div>
                                            <div class="product__view-count"><i style="color: white;"
                                                    class="fas fa-eye"></i></div>
                                        </div>
                                    </div>
                                    <div class="product product__item">
                                        <div class="product-img">
                                            <img src="../static/img/book-test.png" alt="">
                                        </div>
                                        <div class="product-body">
                                            <div>Name:</div>
                                            <div>Price</div>

                                        </div>
                                        <div class="product__option">
                                            <div class="product__add-cart"><i style="color: white;"
                                                    class="fas fa-cart-plus"></i></div>
                                            <div class="product__rate-ting"><i style="color: yellow;"
                                                    class="fas fa-star"></i></div>
                                            <div class="product__view-count"><i style="color: white;"
                                                    class="fas fa-eye"></i></div>
                                        </div>
                                    </div>
                                    <div class="product product__item">
                                        <div class="product-img">
                                            <img src="../static/img/book-test.png" alt="">
                                        </div>
                                        <div class="product-body">
                                            <div>Name:</div>
                                            <div>Price</div>

                                        </div>
                                        <div class="product__option">
                                            <div class="product__add-cart"><i style="color: white;"
                                                    class="fas fa-cart-plus"></i></div>
                                            <div class="product__rate-ting"><i style="color: yellow;"
                                                    class="fas fa-star"></i></div>
                                            <div class="product__view-count"><i style="color: white;"
                                                    class="fas fa-eye"></i></div>
                                        </div>
                                    </div>
                                    <div class="product product__item">
                                        <div class="product-img">
                                            <img src="../static/img/book-test.png" alt="">
                                        </div>
                                        <div class="product-body">
                                            <div>Name:</div>
                                            <div>Price</div>

                                        </div>
                                        <div class="product__option">
                                            <div class="product__add-cart"><i style="color: white;"
                                                    class="fas fa-cart-plus"></i></div>
                                            <div class="product__rate-ting"><i style="color: yellow;"
                                                    class="fas fa-star"></i></div>
                                            <div class="product__view-count"><i style="color: white;"
                                                    class="fas fa-eye"></i></div>
                                        </div>
                                    </div> -->

                                </div>
                                <div id="slick-nav-2" class="products-slick-nav"></div>
                            </div>
                            <!-- /tab -->
                        </div>
                    </div>
                </div>
                <!-- /Products tab & slick -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>

    <!-- SECTION -->
    <!-- /SECTION -->
    <script>
        function myfun() {
            $(document).ready(function () {
                $("#heart").click(function () {
                    if ($("#heart").hasClass("liked")) {
                        $("#heart").html('<i class="fa fa-heart-o" aria-hidden="true"></i>');
                        $("#heart").removeClass("liked");
                    } else {
                        $("#heart").html('<i class="fa fa-heart" aria-hidden="true"></i>');
                        $("#heart").addClass("liked");
                    }
                });
            });
        }
    </script>

    <!-- {% endblock %} -->
    <footer id="footer">
        <!-- top footer -->
        <div class="section">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">

                    <div class="footer">
                        <h3 class="footer-title">About Us</h3>
                        <p>This site is for book Recommendation. On the basis of user's history it recommends the book.
                            Users can also search and rate the book. We made this site as our college term project. It
                            will be upgraded in future. </p>
                        <ul class="footer-links">
                            <li><a href="#"><i class="fa fa-map-marker"></i>175 Tay Son</a></li>
                            <li><a href="#"><i class="fa fa-phone"></i>0988888888</a></li>
                            <li><a href="#"><i class="fa fa-envelope-o"></i>dangphong1520@gmail.com</a></li>
                        </ul>
                    </div>
                </div>
                <!-- /container -->
            </div>
            <!-- /top footer -->

            <!-- bottom footer -->
            <div id="bottom-footer" class="section">
                <div class="container">
                    <!-- row -->
                    <div class="row">
                        <div class="col-md-12 bottom__item text-center">

                            <span class="copyright">
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                Copyright &copy;
                                <script>document.write(new Date().getFullYear());</script> All rights reserved |

                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </span>
                        </div>
                    </div>
                    <!-- /row -->
                </div>
                <!-- /container -->
            </div>
            <!-- /bottom footer -->
    </footer>
    <!-- /FOOTER -->

    <!-- jQuery Plugins -->
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/slick.min.js"></script>
    <script src="../static/js/nouislider.min.js"></script>
    <script src="../static/js/jquery.zoom.min.js"></script>
    <script src="../static/js/main.js"></script>
    <script>


        var queryString = window.location.search;
        console.log(queryString);
        var urlParams = new URLSearchParams(queryString);
        var username = urlParams.get('username');
        var userid = urlParams.get('userid');
        var idBook = urlParams.get('id_book');
        console.log(idBook);
        document.getElementById("get--username").innerHTML = username;
        document.getElementById('go--home').addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = `./index-base.html?userid=${userid}&username=${username}`;
        })
        //search
        document.getElementById("myBtn").addEventListener("click", function (e) {
			e.preventDefault();
			var a = document.getElementById("search--book").value;
			window.location.href = `./search-base.html?search=${a}&userid=${userid}&username=${username}`;
		});

        // logout
        var logout = document.getElementById('logout');
        logout.addEventListener('click', function () {
            if (confirm('Are you sure you want to log out?')) {

                window.localStorage.clear();
                window.location.reload(true);
                window.location.replace('./login-base.html');
            }
        });
        // get cart
        function getCart() {
            return new Promise((resolve, reject) => {
                fetch(`http://192.168.1.83:8000/api/v1/order/?id_user=${userid}`)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {

                        resolve(data);
                    })
                    .catch(err => {
                        reject(err);
                    });
            });
        }
        getCart().then(cate => {

            const queryString = window.location.search;
            console.log(queryString);
            const urlParams = new URLSearchParams(queryString);
            const username = urlParams.get('username');
            const userid = urlParams.get('userid');
            console.log(username);
            document.getElementById("get--username").innerHTML = username;

            var categories = cate.data
            console.log('cc');
            console.log(categories);

            document.getElementById('cart--count').innerHTML = categories.length;

        }).catch(err => {
            console.log(err);
        });

        // recommender
        function getHotBook() {
            return new Promise((resolve, reject) => {
                fetch(`http://192.168.1.83:8000/api/v1/recommender/?id_user=${userid}`)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {

                        resolve(data);
                    })
                    .catch(err => {
                        reject(err);
                    });
            });
        }
        getHotBook().then(data => {

            // console.log(data);
            var books = data.data;
            console.log(books);
            var htmls = books.map(function (book) {
                return `
                        <div class="product product__item">
                            <div class="product-img">
                                <a href=./detail-base.html?id_book=${book.id}&username=${username}&userid=${userid}><img src="${book.image_url}" alt=""></a>
                            </div>
                            <div class="product-body">
                                <div>Tên sách: ${book.book_title}</div>
                                <div>Giá: ${book.book_price}</div>

                            </div>
                            <div class="product__option">
                                <div class="product__add-cart">
                                    <i style="color: white;" class="fas fa-cart-plus"></i>
                                </div>
                                <div class="product__rate-ting"><i style="color: yellow;"
                                        class="fas fa-star"></i></div>
                                <div class="product__view-count"><i style="color: white;"
                                        class="fas fa-eye"></i></div>
                            </div>
                        </div>
                    `





            })
            var html = htmls.join('');
            document.getElementById('product--hot-detail').innerHTML = html

        }).catch(err => {
            console.log(err);
        });

        // get detail
        function getDetail() {
            return new Promise((resolve, reject) => {
                fetch(`http://192.168.1.83:8000/api/v1/details/?id_book=${idBook}`)
                    .then(response => {
                        return response.json();
                    })
                    .then(data => {

                        resolve(data);
                    })
                    .catch(err => {
                        reject(err);
                    });
            });
        }
        getDetail().then(data => {

            // const queryString = window.location.search;
            // console.log(queryString);
            // const urlParams = new URLSearchParams(queryString);
            // const username = urlParams.get('username');
            // const userid = urlParams.get('userid');
            // console.log(username);
            console.log('a');
            console.log(data);
            var books = data.data;
            console.log(books);

            var htmls = books.map(function (book) {
                return `
                    
                <div class="product__img">
                        <img id="product__image" src="${book.image_url}" alt="" srcset="">
                    </div>
                    <div class="product__content">
                        <div class="product__name">Tên Sách: ${book.book_title}</div>
                        <div class="product__rating">
                            <div class="rating__${Math.floor(book.book_rating)}" >
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>

                            <div class="rating__count">(${book.book_rating_count} đánh giá)</div>
                        </div>
                        <div class="product__price">Giá: ${book.book_price} Vnd</div>
                        <div class="product__authour">Tác giả: ${book.book_authrs}</div>
                        <div class="product__price1">Số lượt xem: ${book.book_review_count}</div>
                        <div class="product__price1">Định dạng sách: ${book.book_format}</div>
                        <div class="product__price1">Thể loại sách: ${book.genres}</div>
                        <div class="product__description">Mô tả: ${book.book_desc.substring(1, 600)}...</div>
                        <div class="product__add">
                            <a href="#">Thêm vào giỏ hàng</a>
                            <a href="#">Mua</a>
                        </div>
                    </div>
                `




            })
            var html = htmls.join('');
            document.getElementById('product--detail').innerHTML = html

        }).catch(err => {
            console.log(err);
        });
    </script>
</body>

</html>