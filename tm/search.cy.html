<!-- {% load static %} -->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title> Book Recommndation</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Google font -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

	<!-- Bootstrap -->

	<link type="text/css" rel="stylesheet" href="../static/css/bootstrap.min.css" />

	<!-- Slick -->

	<link type="text/css" rel="stylesheet" href="../static/css/slick.css" />
	<link type="text/css" rel="stylesheet" href="../static/css/slick-theme.css" />

	<!-- nouislider -->

	<link type="text/css" rel="stylesheet" href="../static/css/nouislider.min.css" />

	<!-- Font Awesome Icon -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
	<link rel="stylesheet" href="../static/css/font-awesome.min.css">

	<!-- Custom stlylesheet -->

	<link type="text/css" rel="stylesheet" href="../static/css/style.css" />

	<link type="text/css" rel="stylesheet" href="../static/css/search-style.css" />


	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

</head>

<body>
	<!-- HEADER -->
	<header>
		<script></script>

		<!-- TOP HEADER -->
		<div id="top-header">
			<div class="container">
				<ul class="header-links pull-left">
					<li onclick="myFunction()" id="cl"><a href="#"><i class="fa fa-phone"></i>0988888888</a></li>
					<li><a href="#"><i class="fa fa-envelope-o"></i> dangphong1520@gmail.com</a></li>
					<li><a href="#"><i class="fa fa-map-marker"></i> 175 Tay Son</a></li>
				</ul>
				<ul class="header-links pull-right" id="menu--bar">
					<li class="active"><a href="./index-base.html">Home</a></li>

					<li>
						<font color="red" ;>Welcome, <span id="get--username"></span>
						</font>
					</li>
					<li><a id="logout" href="#">logout</a></li>

				</ul>
			</div>
		</div>

		<!-- {% block blk %} -->
		<div id="header">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<!-- LOGO -->
					<div class="col-md-3">
						<div class="header-logo" id="img--logo">
							<a href="index-base.html" class="logo">
								<img style="border-radius: 50%; margin-top: 15%" src="../static/img/logob.png"
									alt="error">

							</a>

						</div>
						<br />
						<span>
							<h3 style="color: #FFFFFF">YourReads</h3>
						</span>
					</div>


					<!-- /LOGO -->

					<!-- SEARCH BAR -->
					<div class="col-md-6">
						<div class="header-search">
							<form method="POST">
								<div name="stype" class="input-select">
									Book Title
								</div>
								<input type="text" class="input" placeholder="Search here" name="searchbox">
								<a id="search--content"><button name="sbutton" class="search-btn">Search</button></a>
							</form>
						</div>
					</div>
					<!-- /SEARCH BAR -->

					<!-- ACCOUNT -->
					<div class="col-md-3 clearfix">
						<div class="header-ctn">
							<!-- Wishlist -->
							<div>
								<a href="/wishlist">
									<i class="fas fa-shopping-cart"></i>
									<span>Your Wishlist</span>
									<div class="qty">2</div>
								</a>
							</div>
							<!-- /Wishlist -->

				

							<!-- Menu Toogle -->

							<!-- /Menu Toogle -->
						</div>
					</div>
					<!-- /ACCOUNT -->
				</div>
				<!-- row -->
			</div>
			<!-- container -->
		</div>
		<!-- /MAIN HEADER -->
	</header>
	<!-- /HEADER -->


	<!-- SECTION -->
	</div>
	<!-- /SECTION -->


	<!-- SECTION -->
	<div class="section">
		<!-- container -->
		<div class="container">
			<!-- row -->
			<div class="row">

				<!-- section title -->
				<div class="col-md-12">
					<div class="section-title">
						<h3 class="title">
							<span id=result__search></span>
							kết quả tìm kiếm
						</h3>

					</div>
				</div>
				<!-- /section title -->

				<!-- Products tab & slick -->
				<div class="col-md-12" id="product--list">

				</div>
				<div class="col-md-12" id="pagination">
					<div class="content__paging">
						<ul>
							<li class="font--cdn btn-prev"><i class="fas fa-backward"></i></li>
							
							<li class="font--cdn btn-next"><i class="fas fa-forward"></i></li>
						</ul>
					</div>
				</div>
				<!-- Products tab & slick -->
			</div>
			<!-- /row -->
		</div>
		<!-- /container -->
	</div>
	<!-- /SECTION -->
	<script>
		function myfun() {
			$(document).ready(function () {
				$("#heart").click(function () {
					if ($("#heart").hasClass("liked")) {
						$("#heart").html('<i class="fa fa-heart-o" aria-hidden="true"></i>');
						$("#heart").removeClass("liked");
					} else {
						$("#heart").html('<i class="fa fa-heart" aria-hidden="true"></i>');
						$("#heart").addClass("liked");
					}
				});
			});
		}
	</script>

	<!-- {% endblock %} -->
	<footer id="footer">
		<!-- top footer -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">

					<div class="footer">
						<h3 class="footer-title">About Us</h3>
						<p>This site is for book Recommendation. On the basis of user's history it recommends the book.
							Users can also search and rate the book. We made this site as our college term project. It
							will be upgraded in future. </p>
						<ul class="footer-links">
							<li><a href="#"><i class="fa fa-map-marker"></i>175 Tay Son</a></li>
							<li><a href="#"><i class="fa fa-phone"></i>0988888888</a></li>
							<li><a href="#"><i class="fa fa-envelope-o"></i>dangphong1520@gmail.com</a></li>
						</ul>
					</div>
				</div>
				<!-- /container -->
			</div>
			<!-- /top footer -->

			<!-- bottom footer -->
			<div id="bottom-footer" class="section">
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-12 bottom__item text-center">

							<span class="copyright">
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;
								<script>document.write(new Date().getFullYear());</script> All rights reserved |

								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</span>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /bottom footer -->
	</footer>
	<!-- /FOOTER -->

	<!-- jQuery Plugins -->
	<script src="../static/js/login-base.js"></script>
	<script src="../static/js/jquery.min.js"></script>
	<script src="../static/js/bootstrap.min.js"></script>
	<script src="../static/js/slick.min.js"></script>
	<script src="../static/js/nouislider.min.js"></script>
	<script src="../static/js/jquery.zoom.min.js"></script>
	<script src="../static/js/main.js"></script>
	<script>
		var queryString = window.location.search;
		console.log(queryString);
		var urlParams = new URLSearchParams(queryString);
		var username = urlParams.get('username');
		var userid = urlParams.get('userid');
		var search = urlParams.get('search');
		console.log('c');
		console.log(search);
		//log out
		var logout = document.getElementById('logout');
		logout.addEventListener('click', function () {
			console.log('a');
			if (confirm('Are you sure you want to log out?')) {

				window.localStorage.clear();
				window.location.reload(true);
				window.location.replace('./login-base.html');
			}
		})

		function getCurrentPage(currentPage) {
			start = (currentPage - 1) * perPage;
			end = currentPage * perPage;
		}

		var perPage = 8;
		var currentPage = 1;
		var start = 0;
		var end = perPage;
		// Math.ceil()
		const totalPages = 3;
		var obj = {};
		var a = 10;
		var datas;

		const btnNext = document.querySelector('.btn-next');
		const btnPrev = document.querySelector('.btn-prev');

		function getData() {
			var postApi = `http://192.168.1.83:8000/api/v1/details/?book_title=${search}`;
			fetch(postApi)
				.then(function (response) {
					return response.json();
					// JSON.parse: JSON -> Js types
				})
				.then(function (posts) {

					function kFormatter(num) {
						return Math.abs(num) > 999 ? Math.sign(num) * ((Math.abs(num) / 1000).toFixed(0)) + 'k' : Math.sign(num) * Math.abs(num)
					}
					datas = posts.data;
					obj.value
					
					console.log(datas);
					// const nm = new URLSearchParams(location.searchParams).get("username");
					// // fetch(`api/v1/book/?id_book=${bookId}`).then(...)
					// console.log(nm);
					const queryString = window.location.search;
					console.log(queryString);
					const urlParams = new URLSearchParams(queryString);
					const username = urlParams.get('username');
					const userid = urlParams.get('userid');
					console.log(username);
					document.getElementById("get--username").innerHTML = username;

					html = '';
					if(datas.length <= 0){
						html = 'khong tim thay san pham nao'
						document.getElementById('result__search').innerHTML =  0;
						document.getElementById('pagination').innerHTML =  'Không tìm thấy kết quả với từ khóa: '+ '"'+search+'"';
						return html;
					}else{
						document.getElementById('result__search').innerHTML = datas.length;
						var htmls = datas.map(function (data, index) {
							if (index >= start && index < end) {
								html += '<div class="product__item">';
								html += '<div class="product__img">';
								html += '<a href="./detail-base.html?id_book=' + data.id + '&username=' + username + '&userid=' + userid + '"><img src="' + data.image_url + '" alt="' + data.book_title + '" /></a>';
								html += '</div>';
								html += '<div class="product__content">';
								html += '<div>Tên sách:' + data.book_title + '</div>';
								html += '<div>Giá: ' + data.book_price + ',000 Vnd</div>';
								html += '</div>';
								html += '<div id="product__option">';
								html += '<div id="add__detail" class="product__add-cart"><a href="./detail-base.html?id_book=' + data.id + '"><i style="color: white;" class="fas fa-cart-plus"></i></a></div>';
								html += '<div class="product__rate-ting"><a href="#" style="color:white;">' + data.book_rating.toFixed(1) + '<i style="color: yellow;" class="fas fa-star"></i></a></div>';
								html += '<div class="product__view-count"><a href="#" style="color:white;">' + kFormatter(data.book_rating_count) + '<i style="color: white;" class="fas fa-eye"></i></a></div>';
								html += '</div>';
								html += '</div>';
								return html;
							}
						});
					}

					// var html = htmls.join('');
					document.getElementById('product--list').innerHTML = html;
				})
		}
		getData();


		btnNext.addEventListener('click', () => {
			currentPage++;
			if (currentPage > totalPages) {
				currentPage = totalPages;
			}
			getCurrentPage(currentPage);
			getData();
		})

		btnPrev.addEventListener('click', () => {
			currentPage--;
			if (currentPage <= 1) {
				currentPage = 1;
			}
			getCurrentPage(currentPage);
			getData();
		})

		// show list page
		function renderListPage() {
			let html = '';
			html += `<li class="active"><a>${1}</a></li>`;
			for (let i = 2; i <= totalPages; i++) {
				html += `<li><a>${i}</a></li>`
			}
			document.getElementById('number-page').innerHTML = html;
		}

		// event click chang page
		renderListPage();
		function changPage() {
			const currentPages = document.querySelectorAll('.number-page > li');
			for (let i = 0; i <= currentPages.length; i++) {
				currentPages[i].addEventListener('click', () => {
					console.log(currentPages);
					let value = i + 1;
					currentPage = value;
					getCurrentPage(currentPage);
					getData();
				})
			}
		}
		changPage();

		// fetch('http://192.168.1.83:8000/api/v1/recommender/')
		// 	.then(function(response) {
		// 		return response.json();
		// 	})
		// 	.then(function(posts) {
		// 		// console.log(posts);
		// 	});
		//log out
		var logout = document.getElementById('logout');
		logout.addEventListener('click', function () {
			console.log('a');
			if (confirm('Are you sure you want to log out?')) {

				window.localStorage.clear();
				window.location.reload(true);
				window.location.replace('./login-base.html');
			}
		})

		// function myFunction() {
		// 	var myobj = document.getElementById("product--list");
		// 	myobj.remove();
		// }

		// search book


	</script>
</body>

</html>